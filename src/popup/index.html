<html>
    <head>
        <meta charset="UTF-8"/>
        <link rel="stylesheet" type="text/css" href="./popup.css">
    </head>
    <body>
        <div 
            class="flex flex-col w-64 p-4 bg-bkg-1"
            x-data="{
                page: 'home',
                tokensOLD: [
                    {index: 1, icon:'./icons/btc.svg', name: 'BTC', borrow: 10.0, deposit: 5.0, toggle: true},
                    {index: 2, icon:'./icons/eth.svg', name: 'ETH', borrow: 8.0, deposit: 3.0, toggle: true},
                    {index: 3, icon:'./icons/sol.svg', name: 'SOL', borrow: 0.5, deposit: 0.2, toggle: true},
                ],
                tokensInfo: [],
                rawData: []
            }"
            x-init="(async () => {
                const response = await fetch('https://mango-stats-v3.herokuapp.com/spot?mangoGroup=devnet.1')
                if (!response.ok) {
                    alert(`Somthing went wrong: ${response.status} - ${response.statusText}`)
                }
                rawData = await response.json()
                rawData.map(token => {
                    const trimmedName = token.name.replace('/USDC','')
                    tokensInfo.push({
                        name: trimmedName,
                        borrowRate: token.borrowRate.toFixed(2),
                        depositRate: token.depositRate.toFixed(2),
                        toggle: true
                    })
                })
            })()"
        >
            <div x-show="page == 'home'">
                <header class="flex pb-2 mx-auto text-base font-medium text-orange-default">
                <img src="./icons/logo.svg" height="24" width="24" class="mr-1">
                <span>Mango Markets Watch</span>
                </header>
                <div   
                class="flex min-w-full p-1 rounded-lg bg-bkg-2">
                    <table class="flex-col flex-grow mx-auto table-auto">
                        <thead class="bg-bkg-2">
                            <tr class="mb-2 text-xs text-center text-fgd-4">
                            <th class="flex-auto px-2 font-normal text-left">Token</th>
                            <th class="flex-auto px-2 font-normal text-right">Deposit</th>
                            <th class="flex-auto font-normal text-right">/</th>
                            <th class="flex-auto pr-2 font-normal text-right">Borrow</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template 
                                x-for="token in tokensInfo"
                            >
                                <tr x-show="token.toggle">
                                    <td class="flex items-end flex-auto px-2 text-left text-fgd-1" >
                                        <!-- <img :src="token.icon" width="18"
                                        height="18" class='mr-1'> -->
                                        <span x-text="token.name"></span>
                                    </td>
                                    <td class="flex-auto px-2 text-right text-green-default">
                                        <span x-text="token.depositRate"></span>
                                        <span>%</span>
                                    </td>
                                    <td class="flex-auto font-normal text-right text-fgd-2">/</td>
                                    <td class="flex-auto pr-2 text-right text-red-default">
                                        <span x-text="token.borrowRate"></span>
                                        <span>%</span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
            <div x-show="page == 'settings'">
                <header class="flex pb-2 mx-auto text-base font-medium text-orange-default">
                    Token Settings
                </header>
                <div class="rounded-lg bg-bkg-2">
                    <template x-for="token in tokensInfo" :key="token">
                        <div class="flex flex-row">
                            <div 
                                class="flex items-end flex-auto px-2 text-left text-fgd-1" 
                                x-text="token.name">
                            </div>
                            <div class="flex items-center justify-center">
                                <div 
                                    class="relative w-12 h-6 transition duration-200 ease-linear rounded-full"
                                    :class="[token.toggle === true ? 'bg-green-DEFAULT' : 'bg-fgd-4']"
                                >
                                    <label 
                                        x-bind:for="token.name" 
                                        class="absolute left-0 w-6 h-6 mb-2 transition duration-100 ease-linear transform bg-white border-2 rounded-full cursor-pointer"
                                        :class="[token.toggle === true ? 'translate-x-full border-green-DEFAULT' : 'translate-x-0 border-fgd-4']">
                                    </label>
                                    <input 
                                        type="checkbox" 
                                        x-bind:id="token.name" 
                                        x-bind:name="token.name" 
                                        class="w-full h-full appearance-none active:outline-none focus:outline-none"
                                        @click="
                                        token.toggle = ! token.toggle
                                        ">
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            <div x-show="page == 'alert'">
            <header class="flex pb-2 mx-auto text-base font-medium text-orange-default">Alerts</header>
            </div>
            <div class="flex flex-row justify-around pt-2 bg-bkg-1 text-fgd-4">
                <div class="flex-auto text-center">
                    <button x-on:click="page = 'settings'">
                        <img src="./icons/settings.svg" width="24" height="24">
                    </button>
                </div>
                <div class="flex-auto text-center">
                    <button x-on:click="page = 'home'">
                        <img src="./icons/home.svg" width="24" height="24">
                    </button>
                </div>
                <div class="flex-auto text-center">
                    <button x-on:click="page = 'alert'">
                    <img src="./icons/alert.svg" width="24" height="24">
                </button>
                </div>
            </div>
        </div>
        <script type="text/javascript" src="./popup.dist.js"></script>
    </body>
</html>


