<html style="height:21rem">

  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="./popup.css" />
  </head>

  <body 
    class="bg-bkg-1 flex flex-col justify-between" 
    style="width:24rem" 
    x-data="Body()"
  >
    <div class="relative">
      <div class="absolute top-0 right-0 text-white p-1" x-data="TPS">
        <span>TPS:</span>
        <span x-text="$store.TPS.tps"></span>
      </div>
    </div>
    <header class="
      flex
      justify-center
      pt-4
      mx-auto
      text-base
      font-medium
      text-orange-DEFAULT
    ">
      <img src="./icons/logo.svg" height="24" width="24" class="mr-1" />
      <span x-text="getHeaderText()"></span>
    </header>

    <div class="justify-between px-4 py-2 flex flex-col">
      <div class="p-1 rounded-lg bg-bkg-2" style="height: 14.7rem">
      <!-- INFO CONTAINER START -->

        <!-- HOME PAGE START -->
        <div 
          x-show="$store.AppData.page === 'home'" 
          x-data="HomePage"
          style="height: 14.7rem"
        >
          <div class="flex scroller w-72 overflow-y-auto" style="max-height: 14.1rem;">
            <table class="flex-col flex-grow mx-auto table-auto">
              <thead>
                <tr class="text-xs text-fgd-4">
                  <th class="flex-auto pl-8 font-normal text-left">
                    Token
                  </th>
                  <th class="flex-auto px-2 font-normal text-right">
                    Deposit
                  </th>
                  <th class="flex-auto font-normal text-right">/</th>
                  <th class="flex-auto px-2 font-normal text-left">
                    Borrow
                  </th>
                  <th class="flex-auto pr-4 font-normal text-right">
                    Funding (APR)
                  </th>
                </tr>
              </thead>
              <tbody 
                class="text-sm"
              >
                <!-- TOKEN INFO ROWS START -->
                <template x-for="(token, index) in filterToggles()" :key="token[0]">
                  <tr 
                    :class="rowColors(index)"
                    x-data="{highlight: []}"  
                    x-effect="highlight = checkTriggeredTokenData(token[0], $store.TokenAlertsPage.triggered)"
                  >
                    <td
                      class="
                      flex
                      items-end
                      pl-6
                      text-left
                      text-fgd-1
                      "
                    >
                      <img
                        x-data="{icon: './icons/'+(token[0].toLowerCase().replace(/[^\w\s]|_/g, ''))+'.svg'}"
                        :src="icon"
                        width="18"
                        height="18"
                        class="mr-1"
                      />
                      <span x-text="token[0]"></span>
                    </td>
                    <td 
                      class="pr-1 text-right text-green-dark"
                    >
                      <span 
                        x-text="findToken(token[0]).deposit ? findToken(token[0]).deposit : '——'"
                        :class="highlight.includes('deposit') ? 'rounded-l-full bg-orange-DEFAULT text-bkg-1 pl-1' : ''"
                      ></span>
                      <span 
                        :class="highlight.includes('deposit') ? 'rounded-r-full bg-orange-DEFAULT text-bkg-1 -ml-1 px-1': ''"
                      >
                        %
                      </span>
                    </td>
                    <td class="font-normal text-right text-fgd-4">
                      /
                    </td>
                    <td 
                      class="pl-1 text-left text-red-dark"
                    >
                      <span 
                        x-text="findToken(token[0]).borrow ? findToken(token[0]).borrow : '——'"
                        :class="highlight.includes('borrow') ? 'rounded-l-full bg-orange-DEFAULT text-bkg-1 pl-1' : ''"
                      ></span>
                      <span 
                        :class="highlight.includes('borrow') ? 'rounded-r-full bg-orange-DEFAULT text-bkg-1 -ml-1 px-1' : ''"
                      >
                        %
                      </span>
                    </td>
                    <td 
                      class="pr-6 text-right text-fgd-1"
                    >
                      <span 
                        x-text="findToken(token[0]).funding ? findToken(token[0]).funding : '——'"
                        :class="highlight.includes('funding') ? 'rounded-l-full bg-orange-DEFAULT text-bkg-1 pl-1' : ''"
                      ></span>
                      <span 
                        :class="highlight.includes('funding') ? 'rounded-r-full bg-orange-DEFAULT text-bkg-1 -ml-1 px-1' : ''"
                      >
                        %
                      </span>
                    </td>
                  </tr>
                </template>
                <!-- TOKEN INFO ROWS END -->
              </tbody>
            </table>
          </div>
        </div>
        <!-- HOME PAGE END -->

        <!-- SETTINGS PAGE START -->
        <div x-show="$store.AppData.page === 'settings'" style="height: 14.7rem">
          <div class="text-sm text-fgd-1 scroller min-w-full overflow-y-auto py-2 space-y-2" style="max-height: 14.1rem;">
            <div class="flex justify-center">Notifications</div>
            <div class="flex justify-evenly -mt-1 mb-1">
              <div>
                <input type="checkbox" id="browser-notif" name="browser-notif" value="true" x-model="$store.UserData.browserNotifs" checked @change="changeAlertType()">
                <label for="browser-notif">Icon Badge</label>
              </div>
              <div>
                <input type="checkbox" id="os-notif" name="os-notif" value="true" x-model="$store.UserData.OSNotifs" checked @change="changeAlertType()">
                <label for="os-notif">OS Tray</label>
              </div>
            </div>
            <div class="flex justify-center">Tokens</div>
            <div class="
              grid
              grid-cols-2
              gap-x-8
              gap-y-1
              px-8
              table-auto
            ">
              <!-- TOGGLE ROWS START -->
              <template x-for="[baseSymbol, toggle] in Object.entries($store.UserData.toggles)" :key="baseSymbol">
                <div class="flex flex-row pb-1">
                  <div class="flex flex-auto px-2">
                    <img
                      x-data="{icon: './icons/'+(baseSymbol.toLowerCase().replace(/[^\w\s]|_/g, ''))+'.svg'}"
                      :src="icon"
                      width="18"
                      height="18"
                      class="mr-1"
                    />
                    <span x-text="baseSymbol"></span>
                  </div>
                  <div class="flex">
                    <div
                      class="
                      relative
                      w-10
                      h-5
                      transition
                      duration-200
                      ease-linear
                      rounded-full
                      "
                      :class="[toggle === true ? 'bg-green-dark' : 'bg-fgd-4']"
                    >
                      <label
                        :for="baseSymbol"
                        class="
                        absolute
                        left-0
                        w-5
                        h-5
                        mb-2
                        transition
                        duration-100
                        ease-linear
                        transform
                        bg-white
                        border-2
                        rounded-full
                        "
                        :class="[toggle === true ? 'translate-x-full border-green-dark' : 'translate-x-0 border-fgd-4']"
                      >
                      </label>
                      <input
                        type="checkbox"
                        :id="baseSymbol"
                        :name="baseSymbol"
                        class="
                          w-full
                          h-full
                          appearance-none
                          cursor-pointer
                          active:outline-none
                          focus:outline-none
                        "
                        @click="
                          $store.UserData.toggles[baseSymbol] = !toggle;
                          console.info('updating toggles...')
                          chrome.runtime.sendMessage({
                            msg: 'change toggles',
                            data: {
                              toggles: $store.UserData.toggles
                            }
                          })
                        "
                        />
                    </div>
                  </div>
                </div>
              </template>
              <!-- TOGGLE ROWS END -->

            </div>
          </div>
        </div>

        <!-- TOKEN ALERTS PAGE START -->
        <div 
          x-show="$store.AppData.page === 'alert'" 
          style="height: 14.7rem"
          x-data="TokenAlertsPage"
        >
          <div 
            class="scroller min-w-full overflow-y-auto py-2 overflow-y-scroll" 
            style="max-height: 14.1rem;" 
          >
            <div class="text-fgd-1 flex flex-wrap overflow-hidden space-y-2 px-2">

              <!-- TOKEN ALERTS HEADERS START -->
              <div class="w-full flex flex-row text-xs text-fgd-4 justify-between">
                <div class="w-8 font-normal flex justify-center">Status</div>
                <div class="w-16 font-normal flex justify-center">Token</div>
                <div class="w-12 font-normal flex justify-center">Type</div>
                <div class="w-12 font-normal flex justify-center">Side</div>
                <div class="w-12 font-normal flex justify-center">%</div>
                <div class="w-12"></div>
              </div>
              <!-- TOKEN ALERTS HEADERS END -->

              <!-- TOKEN ALERT ROWS START -->
              <div class="w-full">
                <template x-for="id in Object.keys($store.UserData.tokenAlerts)" :key="id">
                  <div 
                    class="flex flex-col space-y-2"
                    x-data="TokenAlertsRow"
                  >
                    <div class="flex flex-row text-sm h-6 justify-between">
                      <div class="w-8 flex font-normal flex justify-center">
                        <svg 
                          xmlns="http://www.w3.org/2000/svg" 
                          class="h-5 w-5 fill-current text-green-dark" 
                          viewBox="0 0 20 20"
                          x-data="{show: false}"
                          x-show="show"
                          x-effect="show = checkTriggeredTokenAlert(id)"
                          >
                          <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm3.707-9.293a1 1 0 0 0-1.414-1.414L9 10.586 7.707 9.293a1 1 0 0 0-1.414 1.414l2 2a1 1 0 0 0 1.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                      </div>
                      <div class="w-16 flex font-normal flex justify-center">
                        <img
                          :src="'./icons/'+($store.UserData.tokenAlerts[id].baseSymbol.toLowerCase().replace(/[^\w\s]|_/g, ''))+'.svg'"
                          width="18"
                          height="18"
                          class="mr-1"
                          />
                        <span x-text="$store.UserData.tokenAlerts[id].baseSymbol"></span>
                      </div>
                      <div class="w-12 font-normal flex justify-center" x-text="$store.UserData.tokenAlerts[id].type"></div>
                      <div class="w-12 font-normal flex justify-center" x-text="$store.UserData.tokenAlerts[id].side"></div>
                      <div class="w-12 font-normal flex justify-end">
                        <span x-text="parsePercent($store.UserData.tokenAlerts[id].percent)"></span>
                        <span>%</span>
                      </div>
                      <div class="w-12 flex flex-row space-x-2">
                        <div class="w-6 font-normal flex justify-center">
                          <button @click="expanded = !expanded, $nextTick(() => document.getElementById('editBaseSymbolInput').focus())" :aria-expanded="expanded">
                          <img src="./icons/pencil.svg" width="18" height="18">
                          </button>
                        </div>
                        <div 
                          class="w-6 font-normal flex justify-center"
                          x-data="{modal: false}"  
                        >
                          <button @click="modal = true">
                            <img src="./icons/delete.svg" width="18" height="18">
                          </button>

                          <!-- Modal start -->
                          <div
                            x-show="modal"
                            style="display: none"
                            x-on:keydown.escape.prevent.stop="open = false"
                            role="dialog"
                            aria-modal="true"
                            x-id="['delete-token-alert']"
                            :aria-labelledby="$id('delete-token-alert')"
                            class="fixed inset-0 overflow-y-auto"
                          >
                            <!-- Overlay -->
                            <div x-show="modal" x-transition.opacity class="fixed inset-0 bg-black bg-opacity-50"></div>

                            <!-- Panel start -->
                            <div
                              x-show="modal" x-transition
                              x-on:click="modal = false"
                              class="relative min-h-screen flex items-center justify-center p-4"
                            >
                              <div
                                x-on:click.stop
                                x-trap.noscroll.inert="modal"
                                class="relative w-2/3 bg-bkg-2 rounded-lg border border-black px-8 py-4 overflow-y-auto"
                              >
                                <!-- Title -->
                                <h2 class="text-xl font-medium text-fgd-1" :id="$id('delete-token-alert')">Confirm</h2>
                                <!-- Content -->
                                <p class="mt-2 text-fgd-2">Are you sure you want to delete this token alert?</p>
                                <!-- Buttons -->
                                <div class="mt-4 flex space-x-4">
                                  <button type="button" x-on:click="deleteTokenAlert(id); modal = false" class="text-fgd-2 bg-red-dark rounded-lg px-4 py-2">
                                      Delete
                                  </button>
                                  <button type="button" x-on:click="modal = false" class="text-fgd-2 bg-bkg-4 rounded-lg px-4 py-2">
                                      Cancel
                                  </button>
                                </div>
                              </div>
                            </div>
                            <!-- Panel end -->
                          </div>
                          <!-- Modal end -->
                        </div>
                      </div>
                    </div>

                    <!-- EDIT TOKEN ALERT FORM START -->
                    <div 
                      x-show="expanded" 
                      x-collapse
                      x-data="{
                        editBaseSymbol: $store.UserData.tokenAlerts[id].baseSymbol,
                        editType: $store.UserData.tokenAlerts[id].type,
                        editSide: $store.UserData.tokenAlerts[id].side,
                        editPercent: $store.UserData.tokenAlerts[id].percent
                      }"
                      @click.outside="expanded = undefined"
                      class="mx-auto"
                    >
                      <div class="flex flex-col justify-center ml-2 bg-bkg-1 text-fgd-1 rounded-lg p-2 space-y-2">
                        <div class="text-center space-y-2">
                          <div>
                            <span>Alert me when</span>
                            <select class="text-black" x-model="editBaseSymbol" id="editBaseSymbolInput">
                              <template x-for="[baseSymbol] in Object.entries($store.UserData.toggles)" :key="baseSymbol">
                                  <option x-text="baseSymbol" :value="baseSymbol" :selected="editBaseSymbol === baseSymbol"></option>
                              </template>
                            </select>
                            <select class="text-black" x-model="editType">
                              <option :selected="editType === 'borrow'">borrow</option>
                              <option :selected="editType === 'deposit'">deposit</option>
                              <option :selected="editType === 'funding'">funding</option>
                            </select>
                            <span>rate</span>
                          </div>
                          <div>
                            <span>is</span>
                            <select class="text-black" x-model="editSide">
                              <option :selected="editSide === 'above'">above</option>
                              <option :selected="editSide === 'below'">below</option>
                            </select>
                            <input 
                              type="text" 
                              size="6" 
                              maxlength="6" 
                              class="text-black" 
                              x-model.number="editPercent" 
                              :value="editPercent" 
                              @change="checkInput($event.target.value)"
                            >
                            <span>percent</span>
                          </div>
                          <div x-show="$store.TokenAlertsPage.inputError">Please input a number</div>
                        </div>
                        <div class="flex justify-center">
                          <button 
                            class="bg-green-dark rounded-full mx-2 px-2 py-1 text-center align-center flex justify-around" 
                            @click="
                              checkInput(editPercent, () => {
                                delete $store.UserData.tokenAlerts[id]
                                delete $store.TokenAlertsPage.triggered[id]
                                createTokenAlert(editBaseSymbol, editType, editSide, editPercent, id)
                                expanded = !expanded
                              })
                            "
                          >
                            Confirm
                          </button>
                          <button 
                            class="bg-red-dark rounded-full px-2 py-1 text-center align-center flex justify-around" 
                            @click="expanded = !expanded"
                          >
                              Cancel
                          </button>
                        </div>
                      </div>
                    </div>
                    <!-- EDIT TOKEN ALERT FORM END -->
                  </div>
                </template>
              </div>
              <!-- TOKEN ALERT ROWS END -->

              <button 
                @click="$store.TokenAlertsPage.addTokenAlert = true; $nextTick(() => document.getElementById('baseSymbol').focus())" 
                class="flex mt-2 mx-auto h-6 w-24 justify-center items-center rounded-full bg-bkg-4 text-fgd-1"
              >
                <span>Add New Alert</span>
              </button>

              <!-- NEW TOKEN ALERT FORM START -->
              <div 
                x-show="$store.TokenAlertsPage.addTokenAlert" 
                x-collapse 
                x-data="{
                  newAlert: {
                    baseSymbol: 'BTC',
                    type: 'borrow',
                    side: 'above',
                    percent: 0
                  }
                }" 
                @click.outside="$store.TokenAlertsPage.addTokenAlert = false" 
                class="mx-auto"
              >
                <div class="flex flex-col justify-center ml-2 bg-bkg-1 text-fgd-1 rounded-lg p-2 space-y-2">
                  <div class="text-center space-y-2">
                    <div>
                      <span>Alert me when</span>
                      <select class="text-black" x-model="newAlert.baseSymbol" id="baseSymbol">
                        <template x-for="[baseSymbol] in Object.entries($store.UserData.toggles)" :key="baseSymbol">
                            <option x-text="baseSymbol" :value="baseSymbol" :selected="baseSymbol === 'BTC'"></option>
                        </template>
                      </select>
                      <select class="text-black" x-model="newAlert.type">
                        <option>borrow</option>
                        <option>deposit</option>
                        <option>funding</option>
                      </select>
                      <span>rate</span>
                    </div>
                    <div>
                      <span>is</span>
                      <select class="text-black" x-model="newAlert.side">
                        <option>above</option>
                        <option>below</option>
                      </select>
                      <input 
                        type="text" 
                        size="6" 
                        maxlength="6" 
                        class="text-black" 
                        x-model.number="newAlert.percent" 
                        @change="checkInput($event.target.value)" 
                        :value="0"
                      >
                      <span>percent</span>
                    </div>
                    <div x-show="$store.TokenAlertsPage.inputError">Please input a number</div>
                  </div>
                  <div class="flex justify-center">
                    <button 
                      class="bg-green-dark rounded-full mx-2 px-2 py-1 text-center align-center flex justify-around" 
                      @click="
                        checkInput(newAlert.percent, () => {
                          createTokenAlert(newAlert.baseSymbol, newAlert.type, newAlert.side, newAlert.percent);
                          $store.TokenAlertsPage.addTokenAlert = !$store.TokenAlertsPage.addTokenAlert;
                          newAlert = {
                            baseSymbol: 'BTC',
                            type: 'borrow',
                            side: 'above',
                            percent: 0
                          }
                        })
                      "
                    >
                      Confirm
                    </button>
                    <button 
                      class="bg-red-dark rounded-full px-2 py-1 text-center align-center flex justify-around" 
                      @click="$store.TokenAlertsPage.addTokenAlert = !$store.TokenAlertsPage.addTokenAlert"
                    >
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
              <!-- NEW TOKEN ALERT FORM END -->

            </div>
          </div>
        </div>
        <!-- TOKEN ALERT PAGE END -->

        <!-- ACCOUNT PAGE START -->
        <div 
          x-show="$store.AppData.page === 'account'" 
          style="height: 14.7rem" 
          x-data="AccountPage"
        >
          <div 
            class="scroller min-w-full overflow-y-auto py-2 overflow-y-scroll" 
            style="max-height: 14.1rem;"
          >
            <!-- View all accounts start -->
            <div 
              class="text-fgd-1 flex flex-col overflow-hidden space-y-2 px-2"
              x-show="$store.AccountPage.selectedAccount === undefined"
              x-data="{accounts: {}}"
              x-effect="accounts = $store.UserData.accounts"
            >
              <div class="w-60 flex flex-row text-xs text-fgd-4 justify-between">
                <div class="flex flex-row ">
                  <div class="w-10 font-normal flex justify-center">Inspect</div>
                  <div class="w-20 font-normal flex justify-center">Address</div>
                  <div class="w-20 font-normal flex justify-center">Balance</div>
                  <div class="w-16 font-normal flex justify-center">Health</div>
                </div>
                <div class="flex w-12"></div>
              </div>

              <!-- ACCOUNT ROWS START --> 
              <template 
                x-for="[address, addressData] in Object.entries(accounts)" 
                :key="address">
                <div 
                  class="w-full text-sm flex flex-col space-y-2"
                  x-data="AccountRow"  
                >
                  <div class="w-60 text-sm flex flex-row h-6 justify-between">
                    <!-- ACCOUNT DATA START -->
                    <div 
                      class="flex flex-row" 
                      x-show="!expandedEdit" 
                    >
                      <div class="w-10 flex font-normal justify-center">
                        <button
                          x-bind="inspect(address)"
                          aria-expanded="open"
                          class="focus:outline-none active:outline-none focus:border-transparent"
                        >
                          <img 
                            src="./icons/search.svg" 
                            width="18" 
                            height="18" 
                          >
                        </button>
                      </div>
                      <div 
                        :class="highlightTriggeredAccount(address)"
                        class="w-20 font-normal flex justify-center rounded-full" 
                        x-text="addressData.name ? addressData.name : address.substring(0, 5)"
                      ></div>
                      <div 
                        class="w-20 font-normal flex justify-center"
                      >
                        <span>$</span>
                        <span x-text="parseBalance(addressData.balance)"></span>
                      </div>
                      <div 
                        class="w-16 font-normal flex justify-center"
                        :class="healthColor(addressData.health)"
                      >
                        <span x-text="parseHealth(addressData.health)"></span>
                        <span>%</span>
                      </div>
                    </div>
                    <!-- ACCOUNT DATA END -->

                    <!-- EDIT ACCOUNT FORM START -->
                    <div 
                      class="w-60 flex flex-row mx-auto space-x-2 items-center"  
                      x-show="expandedEdit"
                      x-data="{editedAddress: address}"
                      @click.outside="expandedEdit = false"
                      >
                      <input 
                        type="text" 
                        class="text-black text-xs h-4 w-3/4" 
                        x-model="editedAddress"
                        id="editAddress"
                        x-bind:id="address"
                        x-on:focus="$el.select()"
                      >
                      <button 
                        @click="deleteAccount(address); addnewAccount(editedAddress); expandedEdit = false"
                        class="flex h-5 px-2 justify-center items-center text-xs rounded-full bg-bkg-4 text-fgd-1"
                      >
                        Confirm
                      </button>
                    </div>
                    <!-- EDIT ACCOUNT FORM END -->
                    
                    <!-- ACCOUNT BUTTONS START -->
                    <div class="w-12 flex flex-row space-x-2">
                      <div class="w-6 font-normal flex justify-center ">
                        <button @click="expandedEdit = !expandedEdit; $nextTick(() => document.getElementById(address).focus())" :aria-expanded="expandedEdit">
                          <img src="./icons/pencil.svg" width="18" height="18">
                        </button>
                      </div>
                      <div 
                        class="w-6 font-normal flex justify-center"
                        x-data="{modal: false}"  
                      >
                        <button @click="modal = true">
                          <img src="./icons/delete.svg" width="18" height="18">
                        </button>
                        <!-- Modal start -->
                        <div
                          x-show="modal"
                          style="display: none"
                          x-on:keydown.escape.prevent.stop="open = false"
                          role="dialog"
                          aria-modal="true"
                          x-id="['delete-account']"
                          :aria-labelledby="$id('delete-account')"
                          class="fixed inset-0 overflow-y-auto"
                        >
                          <!-- Overlay -->
                          <div x-show="modal" x-transition.opacity class="fixed inset-0 bg-black bg-opacity-50"></div>

                          <!-- Panel start -->
                          <div
                            x-show="modal" x-transition
                            x-on:click="modal = false"
                            class="relative min-h-screen flex items-center justify-center p-4"
                          >
                            <div
                              x-on:click.stop
                              x-trap.noscroll.inert="modal"
                              class="relative w-2/3 bg-bkg-2 rounded-lg border border-black px-8 py-4 overflow-y-auto"
                            >
                              <!-- Title -->
                              <h2 class="text-xl font-medium text-fgd-1" :id="$id('delete-account')">Confirm</h2>
                              <!-- Content -->
                              <p class="mt-2 text-fgd-2">Are you sure you want to delete this account?</p>
                              <!-- Buttons -->
                              <div class="mt-4 flex space-x-4">
                                <button type="button" x-on:click="deleteAccount(address); modal = false" class="text-fgd-2 bg-red-dark rounded-lg px-4 py-2">
                                    Delete
                                </button>
                                <button type="button" x-on:click="modal = false" class="text-fgd-2 bg-bkg-4 rounded-lg px-4 py-2">
                                    Cancel
                                </button>
                              </div>
                            </div>
                          </div>
                          <!-- Panel end -->
                        </div>
                      <!-- Modal end -->
                      </div>
                    </div>
                    <!-- ACCOUNT BUTTONS END -->
                  </div>
                </div>
              </template>
              <!-- ACCOUNT ROWS END -->

              
              <!-- ADD ACCOUNT START -->
              <div class="flex flex-col mx-auto space-y-2">
                <button 
                  @click="$store.AccountPage.addingAccount = !$store.AccountPage.addingAccount; $nextTick(() => document.getElementById('addAddress').focus());"
                  class="flex my-1 mx-auto h-6 w-32 justify-center items-center rounded-full bg-bkg-4 text-fgd-1"
                >
                  <span>Add New Account</span>
                </button>
                <div 
                  x-data="{newAccount: ''}" 
                  class="flex flex-row justify-center bg-bkg-1 text-fgd-1 rounded-lg py-2 px-4 space-x-2 items-center"
                  x-show="$store.AccountPage.addingAccount"
                  @click.outside="$store.AccountPage.addingAccount = false"
                >
                  <input 
                    placeholder="Enter a Mango Account" 
                    type="text" 
                    class="text-black" 
                    x-model="newAccount"
                    id="addAddress"
                    x-on:focus="$el.select()"
                  >
                  <button 
                    @click="addNewAccount(newAccount); $store.AccountPage.addingAccount = false; newAccount = ''"
                    class="flex mx-auto h-6 w-12 justify-center items-center rounded-full bg-bkg-4 text-fgd-1"
                  >
                    Add
                  </button>
                </div>
              </div>
              <!-- ADD ACCOUNT END -->

            </div>
            <!-- View all accounts end -->

            <!-- View account details start -->
            <div 
              x-show="$store.AccountPage.selectedAccount !== undefined"
              class="text-fgd-1 flex flex-col flex-wrap overflow-hidden space-y-2 px-2 pb-2"
              x-data="AccountAlerts"
            >
              <button 
                class="flex justify-center items-center absolute top-4 left-4 rounded-full h-6 w-6 bg-bkg-4"
                x-bind="inspect(undefined)"
              >
                <img 
                  src="./icons/arrow-left.svg" 
                  width="18" 
                  height="18" 
                >
              </button>
              <div 
                class="flex flex-col w-64 mx-auto"
                x-data="{
                  name: '',
                  link: '',
                  health: 0,
                  balance: ''
                }"
                x-effect="
                  name = getAccountName($store.AccountPage.selectedAccount)
                  link = getAccountLink($store.AccountPage.selectedAccount)
                  health = getAccountHealth($store.AccountPage.selectedAccount)
                  balance = getAccountBalance($store.AccountPage.selectedAccount)
                "
              >
                <div class="flex flex-row justify-around -mt-2 mb-2 text-base">
                  <a
                    class="underline"
                    x-bind:href="link"
                    target="_blank"
                    x-text="name">
                  </a>
                </div>
                <div class="flex flex-row justify-around">
                  <div>Balance</div>
                  <div x-text="balance"></div>
                  <div>Health</div>
                  <div :class="healthColor(health)">
                    <span x-text="health"></span>
                    <span>%</span>
                  </div>
                </div>
              </div>
              <!-- Account alerts rows start -->
              <div 
                class="flex flex-col"
                x-data="{accountAlerts: []}"
                x-effect="accountAlerts = getAlertsForAccount($store.UserData.accountAlerts)"
              >
                <div class="flex flex-row justify-between text-fgd-4">
                  <div class="w-8 flex justify-center">Status</div>
                  <div class="w-16">Type</div>
                  <div class="w-12">Metric</div>
                  <div class="w-16">$ / %</div>
                  <div class="w-10">Period</div>
                  <div class="w-12"></div>
                </div>
                <template 
                  x-for="alert in accountAlerts"
                  :key="alert.id"
                >
                  <div
                    class="space-y-2"
                    x-data="AccountAlertsRow"
                  >
                    <div 
                      class="flex flex-row justify-between"
                      x-data="{
                        triggered: false,
                        triggerType: '',
                        metricType: '',
                        triggerValue: '',
                        deltaValue: ''
                      }"
                      x-effect="
                        triggered = checkTriggeredAccountAlert(alert, $store.AccountPage.triggered);
                        triggerType = formatForDisplay(alert.triggerType);
                        metricType = formatForDisplay(alert.metricType);
                        triggerValue = formatTriggerValueForDisplay(alert);
                        deltaValue = formatDeltaValueForDisplay(alert);
                      "  
                    >
                      <div class="w-8 flex justify-center">
                        <svg 
                          xmlns="http://www.w3.org/2000/svg" 
                          class="h-5 w-5 fill-current text-green-dark" 
                          viewBox="0 0 20 20"
                          x-show="triggered"
                        >
                          <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm3.707-9.293a1 1 0 0 0-1.414-1.414L9 10.586 7.707 9.293a1 1 0 0 0-1.414 1.414l2 2a1 1 0 0 0 1.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                      </div>
                      <div x-text="triggerType" class="w-16"></div>
                      <div x-text="metricType" class="w-12"></div>
                      <div x-text="triggerValue" class="w-16"></div>
                      <div x-text="deltaValue" class="w-10"></div>
                      <div class="w-12 flex flex-row space-x-2">
                        <div class="w-6 font-normal flex justify-center">
                          <button @click="expanded = !expanded; $store.AccountAlerts.addAccountAlert = false; $nextTick(() => document.getElementById('editTriggerTypeInput').focus())" :aria-expanded="expanded">
                          <img src="./icons/pencil.svg" width="18" height="18">
                          </button>
                        </div>
                        <div 
                          class="w-6 font-normal flex justify-center"
                          x-data="{modal: false}"  
                        >
                          <button @click="modal = true">
                            <img src="./icons/delete.svg" width="18" height="18">
                          </button>

                          <!-- Modal start -->
                          <div
                            x-show="modal"
                            style="display: none"
                            x-on:keydown.escape.prevent.stop="open = false"
                            role="dialog"
                            aria-modal="true"
                            x-id="['delete-account-alert']"
                            :aria-labelledby="$id('delete-account-alert')"
                            class="fixed inset-0 overflow-y-auto"
                          >
                            <!-- Overlay -->
                            <div x-show="modal" x-transition.opacity class="fixed inset-0 bg-black bg-opacity-50"></div>

                            <!-- Panel start -->
                            <div
                              x-show="modal" x-transition
                              x-on:click="modal = false"
                              class="relative min-h-screen flex items-center justify-center p-4"
                            >
                              <div
                                x-on:click.stop
                                x-trap.noscroll.inert="modal"
                                class="relative w-2/3 bg-bkg-2 rounded-lg border border-black px-8 py-4 overflow-y-auto"
                              >
                                <!-- Title -->
                                <h2 class="text-xl font-medium text-fgd-1" :id="$id('delete-account-alert')">Confirm</h2>
                                <!-- Content -->
                                <p class="mt-2 text-fgd-2">Are you sure you want to delete this account alert?</p>
                                <!-- Buttons -->
                                <div class="mt-4 flex space-x-4">
                                  <button type="button" x-on:click="deleteAccountAlert(alert); modal = false" class="text-fgd-2 bg-red-dark rounded-lg px-4 py-2">
                                      Delete
                                  </button>
                                  <button type="button" x-on:click="modal = false" class="text-fgd-2 bg-bkg-4 rounded-lg px-4 py-2">
                                      Cancel
                                  </button>
                                </div>
                              </div>
                            </div>
                            <!-- Panel end -->
                          </div>
                          <!-- Modal end -->
                        </div>
                      </div>
                    </div>
                    <!-- Edit account alert collapsible start -->
                    <div
                      x-show="expanded"
                      @click.outside="expanded = false"
                      class="flex flex-row justify-center bg-bkg-1 text-fgd-1 rounded-lg pt-1 pb-2"
                      x-data="{
                        editTriggerType: alert.triggerType,
                        editMetricType: alert.metricType,
                        editTriggerValue: alert.triggerValue,
                        editDeltaValue: alert.deltaValue,
                        editTimeFrame: alert.timeFrame
                      }"
                    >
                      <div class="w-32 flex flex-col px-6 self-start">
                        <label for="editTriggerTypeInput" class="text-xs">Type</label>
                        <select 
                          id="editTriggerTypeInput" 
                          class="text-black text-xs h-1.5" 
                          x-model="editTriggerType"
                          style="height: 18px;"
                          @change="validateInput()""
                        >
                          <option value="static">Static</option>
                          <option value="change %">Change %</option>
                        </select>
                        <label for="editMetricTypeInput" class="text-xs">Metric</label>
                        <select 
                          id="editMetricTypeInput" 
                          class="text-black text-xs" 
                          x-model="editMetricType"
                          style="height: 18px;"
                        >
                          <option value="balance">Balance</option>
                          <option value="health">Health</option>
                        </select>
                      </div>
                      
                      <div class="w-32 pl-6">
                        <label 
                          for="editTriggerInput" 
                          x-show="editTriggerType === 'static'" 
                          x-text="editMetricType === 'balance' ? 'Balance < X' : 'Health < X'"
                          class="text-xs"
                        ></label>
                        <input 
                          id="editTriggerInput" 
                          type="text" 
                          x-show="editTriggerType === 'static'" 
                          x-model.number="editTriggerValue" 
                          size="8"
                          class="text-black"
                          style="height: 18px;"
                        >
                        <label 
                          x-show="editTriggerType === 'change %'" 
                          for="editDeltaInput"
                          x-text="editMetricType === 'balance' ? 'Balance Change %' : 'Health Change %'"
                          class="text-xs"
                        ></label>
                        <input 
                          x-show="editTriggerType === 'change %'" 
                          type="text" 
                          id="editDeltaInput" 
                          x-model.number="editDeltaValue" 
                          size="8"
                          class="text-black"
                          style="height: 18px;"
                        >
                        <label
                          x-show="editTriggerType === 'change %'"
                          for="editTimeframeInput"
                          class="text-xs"
                        >
                          Period (hrs)
                        </label>
                        <input
                          x-show="editTriggerType =='change %'"
                          type="text"
                          id="editTimeframeInput"
                          x-model.number="editTimeFrame"
                          size="8"
                          class="text-black"
                          style="height: 18px;"
                          @change="validateInput(editTriggerType, editTimeFrame)"
                        >
                      </div>
                      <div class="flex items-center">
                        <div x-show="$store.AccountAlerts.inputError"x-text="$store.AccountAlerts.errorText">
                        </div>
                        <button 
                          x-show="!$store.AccountAlerts.inputError"
                          @click="updateAccountAlert(alert, editTriggerType, editMetricType, editTriggerValue, editDeltaValue, editTimeFrame); expanded = undefined"
                          class="flex mx-2 mt-3 h-6 w-16 justify-center items-center rounded-full bg-bkg-4 text-xs text-fgd-1"
                        >
                          Submit
                        </button>
                      </div>
                    </div>
                  </div>
                  <!-- Edit account alert collapsible end -->
                </template>
              </div>
              <!-- Account alerts rows end -->
              <div>
                <button 
                  @click="$store.AccountAlerts.addAccountAlert = !$store.AccountAlerts.addAccountAlert; $nextTick(() => document.getElementById('triggerType').focus())"
                  :aria-expanded="$store.AccountAlerts.addAccountAlert"
                  class="flex my-1 mx-auto h-6 w-32 justify-center items-center rounded-full bg-bkg-4 text-fgd-1"
                  >
                  <span>Add New Alert</span>
                </button>
              </div>
      
              <!-- New account alert collapsible start -->
              <div
                x-show="$store.AccountAlerts.addAccountAlert"
                @click.outside="$store.AccountAlerts.addAccountAlert = false"
                class="flex flex-row justify-center bg-bkg-1 text-fgd-1 rounded-lg py-2 px-4 items-center"
                x-data="NewAccountAlert()"
              >
                <div class="w-32 flex flex-col px-6 self-start">
                  <label for="triggerType" class="text-xs">Type</label>
                  <select 
                    id="triggerType" 
                    class="text-black text-xs h-1.5" 
                    x-model="$store.NewAccountAlert.triggerType"
                    style="height: 18px;"
                    @change="validateInput()"
                  >
                    <option value="static">Static</option>
                    <option value="change %">Change %</option>
                  </select>
                  <label for="metricType" class="text-xs">Metric</label>
                  <select 
                    id="metricType" 
                    class="text-black text-xs" 
                    x-model="$store.NewAccountAlert.metricType"
                    style="height: 18px;"
                  >
                    <option value="balance">Balance</option>
                    <option value="health">Health</option>
                  </select>
                </div>
                
                <div class="w-32 pl-6">
                  <label 
                    x-show="$store.NewAccountAlert.triggerType === 'static'" 
                    for="trigger" 
                    x-text="$store.NewAccountAlert.metricType === 'balance' ? 'Balance < X' : 'Health < X'"
                    class="text-xs"
                  ></label>
                  <input 
                    x-show="$store.NewAccountAlert.triggerType === 'static'" 
                    type="text" 
                    id="trigger" 
                    x-model.number="$store.NewAccountAlert.triggerValue" 
                    size="8"
                    class="text-black"
                    style="height: 18px;"
                  >
                  <label 
                    x-show="$store.NewAccountAlert.triggerType === 'change %'" 
                    for="delta"
                    x-text="$store.NewAccountAlert.metricType === 'balance' ? 'Balance Change %' : 'Health Change %'"
                    class="text-xs"
                  ></label>
                  <input 
                    x-show="$store.NewAccountAlert.triggerType === 'change %'" 
                    type="text" 
                    id="delta" 
                    x-model.number="$store.NewAccountAlert.deltaValue" 
                    size="8"
                    class="text-black"
                    style="height: 18px;"
                  >
                  <label
                    x-show="$store.NewAccountAlert.triggerType === 'change %'"
                    for="time-frame"
                    class="text-xs"
                  >
                    Period (hrs)
                  </label>
                  <input
                    x-show="$store.NewAccountAlert.triggerType =='change %'"
                    type="text"
                    id="time-frame"
                    x-model.number="$store.NewAccountAlert.timeFrame"
                    size="8"
                    class="text-black"
                    style="height: 18px;"
                    @change="validateInput()"
                  >
      
                  <div x-show="$store.NewAccountAlert.inputError" x-text="$store.NewAccountAlert.errorText"></div>
                  <button 
                    x-show="!$store.NewAccountAlert.inputError"
                    @click="addAccountAlert($store.AccountPage.selectedAccount); $store.AccountAlerts.addAccountAlert = false"
                    class="flex mx-2 mt-3 h-6 w-16 justify-center items-center rounded-full bg-bkg-4 text-xs text-fgd-1"
                  >
                    Submit
                  </button>
                </div>
              </div>
              <!-- New account alert collapsible end -->
            </div>
            <!-- View account details end -->
        
          </div>
        </div>
        <!-- ACCOUNT PAGE END -->
        
      <!-- INFO CONTAINER END -->

      <!-- NAV BUTTONS START-->
        <div
          class="flex flex-row items-end justify-around pt-2 bg-bkg-1 text-fgd-4"
        >
          <div class="flex text-center">
              <button x-bind="navigate('home')">
              <img src="./icons/home.svg" width="24" height="24" />
              </button>
          </div>
          <div class="flex text-center">
              <button x-bind="navigate('alert')">
              <img src="./icons/alert.svg" width="24" height="24" />
              </button>
          </div>
          <div class="flex text-center">
              <button x-bind="navigate('account')">
              <img src="./icons/key.svg" width="24" height="24" />
              </button>
          </div>
          <div class="flex text-center">
              <button x-bind="navigate('settings')">
              <img src="./icons/settings.svg" width="24" height="24" />
              </button>
          </div>
        </div>
      <!-- NAV BUTTONS END -->
  
      </div>
    </div>

    <script type="text/javascript" src="./popup.dist.js"></script>

  </body>
  
</html>